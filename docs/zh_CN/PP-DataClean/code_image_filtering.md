# 二维码图像过滤

------


## 目录

- [1. 背景](#1)
- [2. 模型](#2)
  - [2.1 训练](#2.1)
  - [2.2 部署](#2.2)
- [3. 视觉任务表现](#3)
  - [3.1 验证集指标](#3.1)
  - [3.2 ImageNet 数据指标](#3.2)
  - [3.3 COCO 数据指标](#3.3)
- [4. 总结](#4)

<a name="1"></a>

## 1. 背景

近些年计算机视觉领域迎来了蓬勃的发展，相关的算法也在各种业务上落地，产生了巨大的价值。在落地过程中，数据整理、模型训练、部署后处理等开发环节都至关重要，而在这些重要的环节中，数据的质量可谓是重中之重，其好坏直接决定了最终落地业务的性能。基于此，我们开源了数据清洗的工具，其可以在模型开发的任何阶段使用。在数据整理阶段，其可以通过这个工具筛选掉潜在的低质数据，在模型训练阶段，该工具可以成为数据预处理的一部分，在模型部署及后处理过程中，其可以通过后处理逻辑将低质图片过滤，间接提升模型精度，从而提升用户整体体验。本教程主要介绍数据清洗工具中二维码图像过滤的相关内容。该工具在视觉任务中的使用方式如下图所示：

<div align="center">
  <img src="https://user-images.githubusercontent.com/45199522/200730521-8c3c1bc0-fb77-4416-8b8d-b435c96cb4c1.png" width = "800"/>
</div>

为了使用户方便地使用该工具，我们尽可能提升了该工具的易用性，模型方面，我们使用了非常轻量的模型，在CPU上也可以很快的运行。在使用方面，我们提供了Whl包的使用方式，用户可以方便地集成到Python代码或者shell中。

<a name="2"></a>

## 2. 模型

在方案选型上，我们选择了图像分类的方案，其容易训练、部署，模型大小可以做到非常小，且效果也更容易保证。

<a name="2.1"></a>
#### 2.1 训练

此处我们希望得到一个高精度且轻量级的二分类模型，所以我们采用了PaddleClas的PULC方案，该任务的训练详情可以参考[PULC有无二维码图像分类](@clas_pulc)。

<a name="2.2"></a>
#### 2.2 部署

我们可以很方便地使用 EasyData 的 whl 包进行部署，关于其部署方法，可以参考[二维码图像过滤部署](quick_start.md#232)。

<a name="3"></a>

## 3 视觉任务表现

<a name="3.1"></a>
#### 3.1 验证集指标

在图像有无二维码训练中，我们的评估数据是来自真实采集的数据，其含有2249条含二维码的图像数据，2554条不含二维码的图像数据。其中，二维码包含二维码、条形码、小程序码。我们对训练好的模型的评估，指标如下：

| Accuracy | 模型存储 | 推理时间 | 
| :--: | :--: | :--: |
|   94.9%   |   7M   | 2.1ms | 

<a name="3.2"></a>
#### 3.2 ImageNet 数据指标

我们将二维码过滤模型同样在ImageNet数据上进行了评测，我们将ImageNet val数据（50000条）和[3.1](#3.1)中的二维码数据（2249条）混合起来一起评测。在真实使用场景中，往往在卡特定误报率（FPR）的情况下希望召回率（TPR）越高越好。在该例子中，我们希望ImageNet val的数据尽量被判定为非二维码图片，在此基础上，尽可能将二维码的图像召回。我们评测了不同阈值下的FPR和TPR，相关指标如下：


| 阈值 | FPR| TPR | 
| :--: | :--: | :--: |
| 0.5 | 2.3% | 92.7% | 
| 0.7 | 1.2% | 90.9% | 
| 0.8 | 0.84% | 90.0%| 
| 0.9 | 0.48% | 88.0% | 
| 0.95 | 0.31% | 86.1% | 


**备注：** 

- 该表格中的每一行的含义为在卡阈值的基础上，FPR和TPR的情况。如最后一行表示：将输出的score大于0.95判定为二维码图像，小于0.95判定为非二维码图像，在此基础上，FPR为0.31%，即非二维码的图像（ImageNet val）有0.31%被判定为了二维码的图像；TPR为86.1%，即二维码的图像有86.1%被成功识别出。在具体的场景中，阈值需要根据实际情况调整。

- 我们对ImageNet val的图片做了假设，默认其均为非二维码图像，事实上会有部分二维码，所以在真实场景中，该TPR指标会更高。

<a name="3.3"></a>
#### 3.3 COCO数据指标

我们将二维码过滤模型同样在COCO数据上进行了评测，我们将COCO val数据（5000条）和[3.1](#3.1)中的二维码数据（2249条）混合起来一起评测。在真实使用场景中，往往在卡特定误报率（FPR）的情况下希望召回率（TPR）越高越好。在该例子中，我们希望COCO val的数据尽量被判定为非二维码图片，在此基础上，尽可能将二维码图像召回。我们评测了不同阈值下的FPR和TPR，相关指标如下：


| 阈值 | FPR| TPR | 
| :--: | :--: | :--: |
| 0.5 | 2.7% | 92.7% | 
| 0.7 | 1.4% | 90.9% | 
| 0.8 | 1.0% | 90.0%| 
| 0.9 | 0.42% | 88.0% | 
| 0.95 | 0.2% | 86.1% | 

<a name="4"></a>

## 4 总结

此文档介绍了 EasyData 数据质量提升模块中二维码图像过滤相关的模型介绍、模型训练、模型使用方法以及模型的指标。该能力将会不断建设，敬请期待。
